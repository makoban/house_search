// ========================================
// AIエリア分析 v4.0 - 地名データベース
// 全国市区町村マスタ + 同名地名テーブル
// ========================================

// ---- 全国市区町村データベース ----
// format: { name: 表示名, prefecture: 都道府県, city: 市区町村, prefCode: コード, fullLabel: フル表記 }
var AREA_DATABASE = [];

// ---- ヘルパー: 都道府県エントリ ----
function _addPref(name, code) {
  AREA_DATABASE.push({ name: name, prefecture: name, city: '', prefCode: code, fullLabel: name, type: 'prefecture' });
}

// ---- ヘルパー: 市区町村エントリ ----
// 都道府県→コードの内部マップ（app.jsより先に読み込まれるため自前定義）
var _PREF_CODE_MAP = {
  '北海道':'01','青森県':'02','岩手県':'03','宮城県':'04','秋田県':'05',
  '山形県':'06','福島県':'07','茨城県':'08','栃木県':'09','群馬県':'10',
  '埼玉県':'11','千葉県':'12','東京都':'13','神奈川県':'14','新潟県':'15',
  '富山県':'16','石川県':'17','福井県':'18','山梨県':'19','長野県':'20',
  '岐阜県':'21','静岡県':'22','愛知県':'23','三重県':'24','滋賀県':'25',
  '京都府':'26','大阪府':'27','兵庫県':'28','奈良県':'29','和歌山県':'30',
  '鳥取県':'31','島根県':'32','岡山県':'33','広島県':'34','山口県':'35',
  '徳島県':'36','香川県':'37','愛媛県':'38','高知県':'39','福岡県':'40',
  '佐賀県':'41','長崎県':'42','熊本県':'43','大分県':'44','宮崎県':'45',
  '鹿児島県':'46','沖縄県':'47'
};

function _addCity(pref, city, code) {
  var prefCode = _PREF_CODE_MAP[pref] || '00';
  AREA_DATABASE.push({
    name: city,
    prefecture: pref,
    city: city,
    prefCode: prefCode,
    cityCode: code,
    fullLabel: pref + city,
    type: 'city'
  });
}

// ==== 都道府県 ====
(function() {
  var prefs = [
    ['北海道','01'],['青森県','02'],['岩手県','03'],['宮城県','04'],['秋田県','05'],
    ['山形県','06'],['福島県','07'],['茨城県','08'],['栃木県','09'],['群馬県','10'],
    ['埼玉県','11'],['千葉県','12'],['東京都','13'],['神奈川県','14'],['新潟県','15'],
    ['富山県','16'],['石川県','17'],['福井県','18'],['山梨県','19'],['長野県','20'],
    ['岐阜県','21'],['静岡県','22'],['愛知県','23'],['三重県','24'],['滋賀県','25'],
    ['京都府','26'],['大阪府','27'],['兵庫県','28'],['奈良県','29'],['和歌山県','30'],
    ['鳥取県','31'],['島根県','32'],['岡山県','33'],['広島県','34'],['山口県','35'],
    ['徳島県','36'],['香川県','37'],['愛媛県','38'],['高知県','39'],['福岡県','40'],
    ['佐賀県','41'],['長崎県','42'],['熊本県','43'],['大分県','44'],['宮崎県','45'],
    ['鹿児島県','46'],['沖縄県','47']
  ];
  prefs.forEach(function(p) { _addPref(p[0], p[1]); });
})();

// ==== 政令指定都市 + 東京23区 + 主要市 ====
(function() {
  // 北海道
  _addCity('北海道','札幌市','01100');
  _addCity('北海道','札幌市中央区','01101');
  _addCity('北海道','札幌市北区','01102');
  _addCity('北海道','札幌市東区','01103');
  _addCity('北海道','札幌市白石区','01104');
  _addCity('北海道','札幌市豊平区','01105');
  _addCity('北海道','札幌市南区','01106');
  _addCity('北海道','札幌市西区','01107');
  _addCity('北海道','札幌市厚別区','01108');
  _addCity('北海道','札幌市手稲区','01109');
  _addCity('北海道','札幌市清田区','01110');
  _addCity('北海道','旭川市','01204');
  _addCity('北海道','函館市','01202');

  // 宮城
  _addCity('宮城県','仙台市','04100');
  _addCity('宮城県','仙台市青葉区','04101');
  _addCity('宮城県','仙台市宮城野区','04102');
  _addCity('宮城県','仙台市若林区','04103');
  _addCity('宮城県','仙台市太白区','04104');
  _addCity('宮城県','仙台市泉区','04105');

  // 埼玉
  _addCity('埼玉県','さいたま市','11100');
  _addCity('埼玉県','さいたま市西区','11101');
  _addCity('埼玉県','さいたま市北区','11102');
  _addCity('埼玉県','さいたま市大宮区','11103');
  _addCity('埼玉県','さいたま市見沼区','11104');
  _addCity('埼玉県','さいたま市中央区','11105');
  _addCity('埼玉県','さいたま市桜区','11106');
  _addCity('埼玉県','さいたま市浦和区','11107');
  _addCity('埼玉県','さいたま市南区','11108');
  _addCity('埼玉県','さいたま市緑区','11109');
  _addCity('埼玉県','さいたま市岩槻区','11110');
  _addCity('埼玉県','川口市','11203');
  _addCity('埼玉県','川越市','11201');
  _addCity('埼玉県','所沢市','11208');

  // 千葉
  _addCity('千葉県','千葉市','12100');
  _addCity('千葉県','千葉市中央区','12101');
  _addCity('千葉県','千葉市花見川区','12102');
  _addCity('千葉県','千葉市稲毛区','12103');
  _addCity('千葉県','千葉市若葉区','12104');
  _addCity('千葉県','千葉市緑区','12105');
  _addCity('千葉県','千葉市美浜区','12106');
  _addCity('千葉県','船橋市','12204');
  _addCity('千葉県','柏市','12217');
  _addCity('千葉県','松戸市','12207');

  // 東京23区
  _addCity('東京都','千代田区','13101');
  _addCity('東京都','中央区','13102');
  _addCity('東京都','港区','13103');
  _addCity('東京都','新宿区','13104');
  _addCity('東京都','文京区','13105');
  _addCity('東京都','台東区','13106');
  _addCity('東京都','墨田区','13107');
  _addCity('東京都','江東区','13108');
  _addCity('東京都','品川区','13109');
  _addCity('東京都','目黒区','13110');
  _addCity('東京都','大田区','13111');
  _addCity('東京都','世田谷区','13112');
  _addCity('東京都','渋谷区','13113');
  _addCity('東京都','中野区','13114');
  _addCity('東京都','杉並区','13115');
  _addCity('東京都','豊島区','13116');
  _addCity('東京都','北区','13117');
  _addCity('東京都','荒川区','13118');
  _addCity('東京都','板橋区','13119');
  _addCity('東京都','練馬区','13120');
  _addCity('東京都','足立区','13121');
  _addCity('東京都','葛飾区','13122');
  _addCity('東京都','江戸川区','13123');
  // 東京 その他
  _addCity('東京都','八王子市','13201');
  _addCity('東京都','町田市','13209');
  _addCity('東京都','府中市','13206');
  _addCity('東京都','調布市','13208');
  _addCity('東京都','立川市','13202');

  // 神奈川
  _addCity('神奈川県','横浜市','14100');
  _addCity('神奈川県','横浜市鶴見区','14101');
  _addCity('神奈川県','横浜市神奈川区','14102');
  _addCity('神奈川県','横浜市西区','14103');
  _addCity('神奈川県','横浜市中区','14104');
  _addCity('神奈川県','横浜市南区','14105');
  _addCity('神奈川県','横浜市保土ケ谷区','14106');
  _addCity('神奈川県','横浜市磯子区','14107');
  _addCity('神奈川県','横浜市金沢区','14108');
  _addCity('神奈川県','横浜市港北区','14109');
  _addCity('神奈川県','横浜市戸塚区','14110');
  _addCity('神奈川県','横浜市港南区','14111');
  _addCity('神奈川県','横浜市旭区','14112');
  _addCity('神奈川県','横浜市緑区','14113');
  _addCity('神奈川県','横浜市瀬谷区','14114');
  _addCity('神奈川県','横浜市栄区','14115');
  _addCity('神奈川県','横浜市泉区','14116');
  _addCity('神奈川県','横浜市青葉区','14117');
  _addCity('神奈川県','横浜市都筑区','14118');
  _addCity('神奈川県','川崎市','14130');
  _addCity('神奈川県','川崎市川崎区','14131');
  _addCity('神奈川県','川崎市幸区','14132');
  _addCity('神奈川県','川崎市中原区','14133');
  _addCity('神奈川県','川崎市高津区','14134');
  _addCity('神奈川県','川崎市多摩区','14135');
  _addCity('神奈川県','川崎市宮前区','14136');
  _addCity('神奈川県','川崎市麻生区','14137');
  _addCity('神奈川県','相模原市','14150');
  _addCity('神奈川県','相模原市緑区','14151');
  _addCity('神奈川県','相模原市中央区','14152');
  _addCity('神奈川県','相模原市南区','14153');
  _addCity('神奈川県','藤沢市','14205');

  // 新潟
  _addCity('新潟県','新潟市','15100');
  _addCity('新潟県','新潟市北区','15101');
  _addCity('新潟県','新潟市東区','15102');
  _addCity('新潟県','新潟市中央区','15103');
  _addCity('新潟県','新潟市江南区','15104');
  _addCity('新潟県','新潟市秋葉区','15105');
  _addCity('新潟県','新潟市南区','15106');
  _addCity('新潟県','新潟市西区','15107');
  _addCity('新潟県','新潟市西蒲区','15108');

  // 静岡
  _addCity('静岡県','静岡市','22100');
  _addCity('静岡県','静岡市葵区','22101');
  _addCity('静岡県','静岡市駿河区','22102');
  _addCity('静岡県','静岡市清水区','22103');
  _addCity('静岡県','浜松市','22130');
  _addCity('静岡県','浜松市中央区','22131');
  _addCity('静岡県','浜松市浜名区','22132');
  _addCity('静岡県','浜松市天竜区','22133');

  // 愛知
  _addCity('愛知県','名古屋市','23100');
  _addCity('愛知県','名古屋市千種区','23101');
  _addCity('愛知県','名古屋市東区','23102');
  _addCity('愛知県','名古屋市北区','23103');
  _addCity('愛知県','名古屋市西区','23104');
  _addCity('愛知県','名古屋市中村区','23105');
  _addCity('愛知県','名古屋市中区','23106');
  _addCity('愛知県','名古屋市昭和区','23107');
  _addCity('愛知県','名古屋市瑞穂区','23108');
  _addCity('愛知県','名古屋市熱田区','23109');
  _addCity('愛知県','名古屋市中川区','23110');
  _addCity('愛知県','名古屋市港区','23111');
  _addCity('愛知県','名古屋市南区','23112');
  _addCity('愛知県','名古屋市守山区','23113');
  _addCity('愛知県','名古屋市緑区','23114');
  _addCity('愛知県','名古屋市名東区','23115');
  _addCity('愛知県','名古屋市天白区','23116');
  _addCity('愛知県','豊田市','23211');
  _addCity('愛知県','豊橋市','23201');
  _addCity('愛知県','岡崎市','23202');

  // 京都
  _addCity('京都府','京都市','26100');
  _addCity('京都府','京都市北区','26101');
  _addCity('京都府','京都市上京区','26102');
  _addCity('京都府','京都市左京区','26103');
  _addCity('京都府','京都市中京区','26104');
  _addCity('京都府','京都市東山区','26105');
  _addCity('京都府','京都市下京区','26106');
  _addCity('京都府','京都市南区','26107');
  _addCity('京都府','京都市右京区','26108');
  _addCity('京都府','京都市伏見区','26109');
  _addCity('京都府','京都市山科区','26110');
  _addCity('京都府','京都市西京区','26111');

  // 大阪
  _addCity('大阪府','大阪市','27100');
  _addCity('大阪府','大阪市都島区','27102');
  _addCity('大阪府','大阪市福島区','27103');
  _addCity('大阪府','大阪市此花区','27104');
  _addCity('大阪府','大阪市西区','27106');
  _addCity('大阪府','大阪市港区','27107');
  _addCity('大阪府','大阪市大正区','27108');
  _addCity('大阪府','大阪市天王寺区','27109');
  _addCity('大阪府','大阪市浪速区','27111');
  _addCity('大阪府','大阪市西淀川区','27113');
  _addCity('大阪府','大阪市東淀川区','27114');
  _addCity('大阪府','大阪市東成区','27115');
  _addCity('大阪府','大阪市生野区','27116');
  _addCity('大阪府','大阪市旭区','27117');
  _addCity('大阪府','大阪市城東区','27118');
  _addCity('大阪府','大阪市阿倍野区','27119');
  _addCity('大阪府','大阪市住吉区','27120');
  _addCity('大阪府','大阪市東住吉区','27121');
  _addCity('大阪府','大阪市西成区','27122');
  _addCity('大阪府','大阪市淀川区','27123');
  _addCity('大阪府','大阪市鶴見区','27124');
  _addCity('大阪府','大阪市住之江区','27125');
  _addCity('大阪府','大阪市平野区','27126');
  _addCity('大阪府','大阪市北区','27127');
  _addCity('大阪府','大阪市中央区','27128');
  _addCity('大阪府','堺市','27140');
  _addCity('大阪府','堺市堺区','27141');
  _addCity('大阪府','堺市中区','27142');
  _addCity('大阪府','堺市東区','27143');
  _addCity('大阪府','堺市西区','27144');
  _addCity('大阪府','堺市南区','27145');
  _addCity('大阪府','堺市北区','27146');
  _addCity('大阪府','堺市美原区','27147');

  // 兵庫
  _addCity('兵庫県','神戸市','28100');
  _addCity('兵庫県','神戸市東灘区','28101');
  _addCity('兵庫県','神戸市灘区','28102');
  _addCity('兵庫県','神戸市兵庫区','28105');
  _addCity('兵庫県','神戸市長田区','28106');
  _addCity('兵庫県','神戸市須磨区','28107');
  _addCity('兵庫県','神戸市垂水区','28108');
  _addCity('兵庫県','神戸市北区','28109');
  _addCity('兵庫県','神戸市中央区','28110');
  _addCity('兵庫県','神戸市西区','28111');
  _addCity('兵庫県','姫路市','28201');
  _addCity('兵庫県','西宮市','28204');
  _addCity('兵庫県','尼崎市','28202');

  // 岡山
  _addCity('岡山県','岡山市','33100');
  _addCity('岡山県','岡山市北区','33101');
  _addCity('岡山県','岡山市中区','33102');
  _addCity('岡山県','岡山市東区','33103');
  _addCity('岡山県','岡山市南区','33104');
  _addCity('岡山県','倉敷市','33202');

  // 広島
  _addCity('広島県','広島市','34100');
  _addCity('広島県','広島市中区','34101');
  _addCity('広島県','広島市東区','34102');
  _addCity('広島県','広島市南区','34103');
  _addCity('広島県','広島市西区','34104');
  _addCity('広島県','広島市安佐南区','34105');
  _addCity('広島県','広島市安佐北区','34106');
  _addCity('広島県','広島市安芸区','34107');
  _addCity('広島県','広島市佐伯区','34108');
  _addCity('広島県','福山市','34207');

  // 福岡
  _addCity('福岡県','福岡市','40130');
  _addCity('福岡県','福岡市東区','40131');
  _addCity('福岡県','福岡市博多区','40132');
  _addCity('福岡県','福岡市中央区','40133');
  _addCity('福岡県','福岡市南区','40134');
  _addCity('福岡県','福岡市西区','40135');
  _addCity('福岡県','福岡市城南区','40136');
  _addCity('福岡県','福岡市早良区','40137');
  _addCity('福岡県','北九州市','40100');
  _addCity('福岡県','北九州市門司区','40101');
  _addCity('福岡県','北九州市若松区','40102');
  _addCity('福岡県','北九州市戸畑区','40103');
  _addCity('福岡県','北九州市小倉北区','40104');
  _addCity('福岡県','北九州市小倉南区','40105');
  _addCity('福岡県','北九州市八幡東区','40106');
  _addCity('福岡県','北九州市八幡西区','40107');
  _addCity('福岡県','久留米市','40203');

  // 熊本
  _addCity('熊本県','熊本市','43100');
  _addCity('熊本県','熊本市中央区','43101');
  _addCity('熊本県','熊本市東区','43102');
  _addCity('熊本県','熊本市西区','43103');
  _addCity('熊本県','熊本市南区','43104');
  _addCity('熊本県','熊本市北区','43105');

  // その他 主要都市
  _addCity('青森県','青森市','02201');
  _addCity('岩手県','盛岡市','03201');
  _addCity('秋田県','秋田市','05201');
  _addCity('山形県','山形市','06201');
  _addCity('福島県','福島市','07201');
  _addCity('福島県','郡山市','07203');
  _addCity('茨城県','水戸市','08201');
  _addCity('茨城県','つくば市','08220');
  _addCity('栃木県','宇都宮市','09201');
  _addCity('群馬県','前橋市','10201');
  _addCity('群馬県','高崎市','10202');
  _addCity('富山県','富山市','16201');
  _addCity('石川県','金沢市','17201');
  _addCity('福井県','福井市','18201');
  _addCity('山梨県','甲府市','19201');
  _addCity('長野県','長野市','20201');
  _addCity('長野県','松本市','20202');
  _addCity('岐阜県','岐阜市','21201');
  _addCity('三重県','津市','24201');
  _addCity('三重県','四日市市','24202');
  _addCity('滋賀県','大津市','25201');
  _addCity('奈良県','奈良市','29201');
  _addCity('和歌山県','和歌山市','30201');
  _addCity('鳥取県','鳥取市','31201');
  _addCity('島根県','松江市','32201');
  _addCity('山口県','下関市','35201');
  _addCity('徳島県','徳島市','36201');
  _addCity('香川県','高松市','37201');
  _addCity('愛媛県','松山市','38201');
  _addCity('高知県','高知市','39201');
  _addCity('佐賀県','佐賀市','41201');
  _addCity('長崎県','長崎市','42201');
  _addCity('大分県','大分市','44201');
  _addCity('宮崎県','宮崎市','45201');
  _addCity('鹿児島県','鹿児島市','46201');
  _addCity('沖縄県','那覇市','47201');
})();

// ---- 地名検索関数 ----
function searchArea(input) {
  if (!input) return [];
  var q = input.trim();

  var results = [];

  // 完全一致（fullLabel / name / city）
  AREA_DATABASE.forEach(function(a) {
    if (a.fullLabel === q || a.name === q || a.city === q) {
      results.push(a);
    }
  });

  // 完全一致がなければ前方一致
  if (results.length === 0) {
    AREA_DATABASE.forEach(function(a) {
      if (a.fullLabel.indexOf(q) === 0 || a.name.indexOf(q) === 0) {
        results.push(a);
      }
    });
  }

  // 部分一致
  if (results.length === 0) {
    AREA_DATABASE.forEach(function(a) {
      if (a.fullLabel.indexOf(q) >= 0 || a.name.indexOf(q) >= 0) {
        results.push(a);
      }
    });
  }

  // 重複除去（同じfullLabelのものは1つ）
  var seen = {};
  var unique = [];
  results.forEach(function(r) {
    if (!seen[r.fullLabel]) {
      seen[r.fullLabel] = true;
      unique.push(r);
    }
  });

  return unique;
}
